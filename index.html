<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Max Mustermann</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* --- Grundlegende Stile & Schriftart --- */
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Pixelify+Sans:wght@400;700&display=swap');

        body {
            background-color: #008080; /* Klassisches Teal-Hintergrund */
            font-family: 'Pixelify Sans', sans-serif;
            overflow: hidden;
            margin: 0;
            user-select: none;
            transition: background-color 0.5s;
        }

        /* --- System Screens --- */
        .system-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            display: none;
            color: white;
            font-family: 'VT323', monospace;
        }

        #bsod { background-color: #0000AA; font-size: 20px; padding: 20px; white-space: pre; }
        @keyframes bsod-flicker { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        .flicker { animation: bsod-flicker 0.1s infinite; }
        #boot-screen { background-color: #000; font-size: 18px; padding: 10px; white-space: pre-wrap; }
        #login-screen { background-color: #008080; display: none; align-items: center; justify-content: center; }
        #login-box { background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 20px; width: 300px; text-align: center; }
        #login-box label { display: block; margin-bottom: 10px; font-size: 18px; }
        #login-box input { width: 100%; padding: 5px; box-sizing: border-box; border: 1px inset #808080; margin-bottom: 10px; }
        #login-box button { background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 5px 15px; font-family: 'Pixelify Sans', sans-serif; font-size: 16px; cursor: pointer; }
        #login-box button:active { border-color: #808080 #ffffff #ffffff #808080; }
        #screensaver { background-color: #000; z-index: 9999; }
        #screensaver-canvas { width: 100%; height: 100%; }

        /* --- Desktop-Symbole --- */
        .desktop { width: 100vw; height: calc(100vh - 40px); position: relative; padding: 20px; box-sizing: border-box; }
        .icon { width: 80px; text-align: center; color: white; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 5px; position: absolute; }
        .icon:hover { background-color: rgba(0, 0, 128, 0.5); outline: 1px dotted #fff; }
        .icon img { width: 48px; height: 48px; }
        .icon span { background-color: #008080; transition: background-color 0.5s; }

        /* --- Fenster-Stile --- */
        .window { width: 550px; height: 400px; background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); position: absolute; top: 100px; left: 150px; display: none; flex-direction: column; resize: both; overflow: auto; min-width: 300px; min-height: 200px; transition: top 0.2s, left 0.2s, width 0.2s, height 0.2s; }
        .title-bar { background-color: #000080; color: white; padding: 4px 8px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: move; height: 24px; transition: background-color 0.5s; flex-shrink: 0; }
        .window-controls { display: flex; }
        .window-controls button { width: 20px; height: 20px; background-color: #c0c0c0; border: 1px solid; border-color: #ffffff #808080 #808080 #ffffff; margin-left: 2px; font-family: monospace; font-weight: bold; display: flex; align-items: center; justify-content: center; padding: 0; padding-bottom: 2px; box-sizing: border-box; }
        .window-controls button:active { border-color: #808080 #ffffff #ffffff #808080; }
        .window-content { padding: 15px; flex-grow: 1; background-color: white; margin: 5px; border: 1px solid #808080; overflow-y: auto; font-size: 16px; line-height: 1.6; }
        .window-content h2 { margin-top: 0; }
        .window-content a { color: #0000FF; text-decoration: underline; }
        .window-content ul { padding-left: 20px; }
        .window-content li { margin-bottom: 10px; }

        /* --- Explorer-Fenster --- */
        #explorer-window { width: 700px; height: 500px; }
        #explorer-window .window-content { margin: 0; padding: 0; display: flex; flex-direction: column; }
        .explorer-body { display: flex; flex-grow: 1; }
        .explorer-sidebar { width: 150px; background: #c0c0c0; border-right: 2px solid; border-color: #808080; padding: 10px; flex-shrink: 0; }
        .explorer-sidebar-item { cursor: pointer; padding: 5px; display: flex; align-items: center; gap: 5px; }
        .explorer-sidebar-item:hover { background: #b0b0b0; }
        .explorer-sidebar-item img { width: 20px; height: 20px; }
        .explorer-main { flex-grow: 1; background: white; padding: 10px; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 15px; overflow-y: auto; }
        .fs-item { cursor: pointer; width: 80px; text-align: center; }
        .fs-item img { width: 48px; height: 48px; }
        .fs-item span { display: block; word-wrap: break-word; }
        #explorer-address-bar { padding: 4px; background: #c0c0c0; border-bottom: 1px solid #808080; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- Editor-Fenster --- */
        #editor-window .window-content { white-space: pre-wrap; font-family: 'VT323', monospace; background: #fff; }

        /* --- Browser-Fenster --- */
        #browser-window { width: 800px; height: 600px; }
        #browser-window .window-content { padding: 0; margin: 0; display: flex; flex-direction: column; }
        .browser-toolbar { padding: 5px; background: #c0c0c0; border-bottom: 2px solid #808080; flex-shrink: 0; }
        .browser-toolbar input { width: 100%; padding: 3px; border: 1px inset #808080; }
        .browser-bookmarks { padding: 5px; background: #c0c0c0; border-bottom: 2px solid #808080; flex-shrink: 0; }
        .browser-bookmarks button { background-color: #c0c0c0; border: 1px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 2px 8px; }
        #browser-frame { flex-grow: 1; border: none; }

        /* --- Terminal-Stile --- */
        #terminal-window .window-content { background-color: #000; color: #00FF00; font-family: 'VT323', monospace; padding: 10px; display: flex; flex-direction: column; overflow-y: scroll; }
        #terminal-output { flex-grow: 1; white-space: pre-wrap; word-break: break-all; }
        #terminal-output .dir { color: #87ceeb; }
        #terminal-input-line { display: flex; }
        #terminal-prompt { white-space: nowrap; }
        #terminal-input { background: none; border: none; color: #00FF00; font-family: 'VT323', monospace; flex-grow: 1; outline: none; }
        
        /* --- Snake Game Stile --- */
        #snake-window .window-content { padding: 20px; box-sizing: border-box; margin: 0; background-color: #000; overflow: hidden; display: flex; align-items: center; flex-direction: column; }
        #snake-canvas { background-color: #111; }
        .snake-controls { padding-top: 10px; }
        #snake-restart-btn { background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 5px 15px; font-family: 'Pixelify Sans', sans-serif; font-size: 16px; cursor: pointer; }
        #snake-restart-btn:active { border-color: #808080 #ffffff #ffffff #808080; }
        
        /* --- Einstellungs-Fenster --- */
        .settings-section { margin-bottom: 20px; }
        .settings-section h3 { margin-bottom: 10px; }
        .radio-group label { display: block; margin-bottom: 5px; }
        
        /* --- GÃ¤stebuch-Fenster --- */
        #guestbook-window .window-content { display: flex; flex-direction: column; }
        #guestbook-entries { flex-grow: 1; border: 1px inset #808080; padding: 5px; background: #fff; overflow-y: auto; margin-bottom: 10px; }
        .guestbook-entry { border-bottom: 1px solid #ccc; padding: 5px 0; }
        .guestbook-entry strong { color: #000080; }
        #guestbook-form { flex-shrink: 0; }
        #guestbook-form input, #guestbook-form textarea { width: 100%; box-sizing: border-box; margin-bottom: 5px; padding: 3px; border: 1px inset #808080; }
        #guestbook-form textarea { resize: vertical; height: 60px; }
        #guestbook-form button { background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 5px 15px; }
        #guestbook-form button:active { border-color: #808080 #ffffff #ffffff #808080; }

        /* --- Paint-Fenster --- */
        #paint-window { width: 600px; height: 450px; }
        #paint-window .window-content { display: flex; padding: 5px; gap: 5px; }
        .paint-toolbar { display: flex; flex-direction: column; gap: 5px; }
        .color-swatch { width: 24px; height: 24px; border: 1px solid #808080; cursor: pointer; }
        .color-swatch.active { border: 2px solid #000; }
        #paint-canvas { border: 1px inset #808080; background: #fff; cursor: crosshair; }

        /* --- Taskleiste --- */
        .taskbar { position: absolute; bottom: 0; left: 0; width: 100%; height: 40px; background-color: #c0c0c0; border-top: 2px solid #ffffff; display: flex; align-items: center; padding: 0 5px; box-sizing: border-box; }
        .start-button { background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 5px 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; flex-shrink: 0; }
        .start-button:active { border-color: #808080 #ffffff #ffffff #808080; }
        .start-button img { width: 24px; margin-right: 5px; }
        .taskbar-apps { display: flex; gap: 5px; margin-left: 5px; overflow: hidden; }
        .taskbar-app-btn { background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 5px 10px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .taskbar-app-btn.active { border-color: #808080 #ffffff #ffffff #808080; background-color: #e0e0e0; }
        .clock { margin-left: auto; border: 1px solid #808080; border-right-color: #fff; border-bottom-color: #fff; padding: 5px 10px; font-size: 14px; flex-shrink: 0; }
        
        /* --- StartmenÃ¼ & KontextmenÃ¼ --- */
        .menu { position: absolute; background-color: #c0c0c0; border: 2px solid; border-color: #ffffff #808080 #808080 #ffffff; padding: 2px; display: none; z-index: 5000; }
        .menu ul { list-style: none; margin: 0; padding: 0; }
        .menu li { padding: 8px 20px 8px 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; white-space: nowrap; position: relative; }
        .menu li:hover { background-color: #000080; color: white; }
        .menu img { width: 24px; height: 24px; }
        .menu .menu-divider { height: 1px; background: #808080; border-bottom: 1px solid #fff; margin: 2px 0; padding: 0; }
        #start-menu { bottom: 40px; left: 0; width: 220px; }
        .submenu { left: 100%; top: -2px; display: none; }
        .has-submenu:hover > .submenu { display: block; }
        .has-submenu::after { content: 'âº'; position: absolute; right: 5px; }

    </style>
</head>
<body>
    <div id="bsod" class="system-screen"></div>
    <div id="boot-screen" class="system-screen"></div>
    <div id="login-screen" class="system-screen">
        <div id="login-box">
            <label for="username-input">Benutzername eingeben</label>
            <input type="text" id="username-input" autofocus>
            <button id="login-btn">Login</button>
        </div>
    </div>
    <div id="screensaver" class="system-screen">
        <canvas id="screensaver-canvas"></canvas>
    </div>

    <div class="desktop" id="desktop">
        
        <div class="icon" style="top: 20px; left: 20px;" data-window="about-me-window"><img src="https://img.icons8.com/win95/48/computer.png"><span data-lang-key="aboutMe">Ãber Mich</span></div>
        <div class="icon" style="top: 120px; left: 20px;" data-action="open-explorer" data-path="home/user/Documents/projects"><img src="https://img.icons8.com/win95/48/folder.png"><span data-lang-key="projects">Projekte</span></div>
        <div class="icon" style="top: 220px; left: 20px;" data-window="skills-window"><img src="https://img.icons8.com/win95/48/documents.png"><span data-lang-key="skills">FÃ¤higkeiten</span></div>
        <div class="icon" style="top: 320px; left: 20px;" data-window="contact-window"><img src="https://img.icons8.com/win95/48/email.png"><span data-lang-key="contact">Kontakt</span></div>
        <div class="icon" id="terminal-icon" style="top: 20px; left: 120px;" data-window="terminal-window"><img src="https://img.icons8.com/win95/48/console.png"><span data-lang-key="terminal">Terminal</span></div>
        <div class="icon" id="snake-icon" style="top: 120px; left: 120px;" data-window="snake-window"><img src="https://img.icons8.com/win95/48/snake.png"><span data-lang-key="snake">Snake</span></div>
        <div class="icon" id="info-icon" style="top: 220px; left: 120px;" data-window="info-window"><img src="https://img.icons8.com/win95/48/help.png"><span data-lang-key="info">Readme.txt</span></div>
        <div class="icon" id="explorer-icon" style="top: 320px; left: 120px;" data-action="open-explorer" data-path="home/user"><img src="https://img.icons8.com/win95/48/file-explorer.png"><span data-lang-key="explorer">Explorer</span></div>
        <div class="icon" id="guestbook-icon" style="top: 20px; left: 220px;" data-window="guestbook-window"><img src="https://img.icons8.com/win95/48/address-book.png"><span data-lang-key="guestbook">GÃ¤stebuch</span></div>
        <div class="icon" id="browser-icon" style="top: 120px; left: 220px;" data-window="browser-window"><img src="https://img.icons8.com/win95/48/internet-explorer.png"><span data-lang-key="browser">Internet</span></div>
        <div class="icon" id="paint-icon" style="top: 220px; left: 220px;" data-window="paint-window"><img src="https://img.icons8.com/win95/48/paint.png"><span data-lang-key="paint">Paint</span></div>

        <!-- Anwendungsfenster -->
        <div class="window" id="about-me-window"><div class="title-bar"><span data-lang-key="aboutMe">Ãber Mich</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><h2 data-lang-key="welcomeTitle">Willkommen auf meinem Desktop!</h2><p data-lang-key="welcomeP1">Ich bin Max Mustermann, ein leidenschaftlicher Softwareentwickler...</p></div></div>
        <div class="window" id="skills-window"><div class="title-bar"><span data-lang-key="skills">FÃ¤higkeiten</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><h2 data-lang-key="myTechStack">Mein Tech-Stack</h2><p data-lang-key="techStackIntro">Hier sind einige Technologien...</p><ul><li>...</li></ul></div></div>
        <div class="window" id="contact-window"><div class="title-bar"><span data-lang-key="contact">Kontakt</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><h2 data-lang-key="contactTitle">Lassen Sie uns vernetzen!</h2><p data-lang-key="contactIntro">Ich bin immer offen...</p></div></div>
        <div class="window" id="terminal-window" style="width: 600px; height: 350px;"><div class="title-bar"><span>user@desktop</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><div id="terminal-output"></div><div id="terminal-input-line"><span id="terminal-prompt">~/ $ </span><input type="text" id="terminal-input" autofocus></div></div></div>
        <div class="window" id="snake-window" style="width: 444px; height: 530px; resize: none;"><div class="title-bar"><span data-lang-key="snake">Snake</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><canvas id="snake-canvas" width="400" height="400"></canvas><div class="snake-controls"><button id="snake-restart-btn" style="display: none;" data-lang-key="restart">Neustart</button></div></div></div>
        
        <div class="window" id="settings-window" style="width: 400px; height: 350px;"><div class="title-bar"><span data-lang-key="settings">Einstellungen</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><div class="settings-section"><h3 data-lang-key="language">Sprache</h3><select id="language-select"><option value="de">Deutsch</option><option value="en">English</option></select></div><div class="settings-section"><h3 data-lang-key="theme">Farbschema</h3><div class="radio-group" id="theme-selector"><label><input type="radio" name="theme" value="default" checked> <span data-lang-key="theme_default">Klassisch</span></label><label><input type="radio" name="theme" value="theme-night"> <span data-lang-key="theme_night">Nachtmodus</span></label><label><input type="radio" name="theme" value="theme-purple"> <span data-lang-key="theme_purple">Lila Traum</span></label></div></div></div></div>
        
        <div class="window" id="info-window" style="width: 500px; height: auto; top: 60px; left: 80px;"><div class="title-bar"><span data-lang-key="infoTitle">Willkommen!</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><h2 data-lang-key="infoHeading">Hey! SchÃ¶n, dass du da bist!</h2><p data-lang-key="infoIntro">Dieses Portfolio ist ein bisschen anders...</p><ul><li data-lang-key="infoFeature1">...</li><li data-lang-key="infoFeature2">...</li><li data-lang-key="infoFeature3">...</li><li data-lang-key="infoFeature4">...</li></ul><p data-lang-key="infoOutro">Viel SpaÃ beim Entdecken!</p></div></div>

        <div class="window" id="explorer-window"><div class="title-bar"><span data-lang-key="explorer">Explorer</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content"><div id="explorer-address-bar"></div><div class="explorer-body"><div class="explorer-sidebar"></div><div class="explorer-main"></div></div></div></div>
        <div class="window" id="editor-window" style="width: 450px; height: 300px;"><div class="title-bar"><span id="editor-title">Editor</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div><div class="window-content" id="editor-content"></div></div>
        
        <div class="window" id="guestbook-window" style="width: 500px; height: 500px;">
            <div class="title-bar"><span data-lang-key="guestbook">GÃ¤stebuch</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div>
            <div class="window-content">
                <div id="guestbook-entries"></div>
                <form id="guestbook-form">
                    <input type="text" id="guestbook-name" placeholder="Dein Name" required>
                    <textarea id="guestbook-message" placeholder="Deine Nachricht..." required></textarea>
                    <button type="submit">Eintragen</button>
                </form>
            </div>
        </div>
        
        <div class="window" id="browser-window">
            <div class="title-bar"><span data-lang-key="browser">Internet</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div>
            <div class="window-content">
                <div class="browser-toolbar">
                    <input type="text" id="browser-url-input" value="https://www.google.com/webhp?igu=1">
                </div>
                <div class="browser-bookmarks">
                    <button data-url="https://github.com">GitHub</button>
                    <button data-url="https://linkedin.com">LinkedIn</button>
                </div>
                <iframe id="browser-frame" src="https://www.google.com/webhp?igu=1" sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts"></iframe>
            </div>
        </div>
        
        <div class="window" id="paint-window">
            <div class="title-bar"><span data-lang-key="paint">Paint</span><div class="window-controls"><button class="minimize-btn">_</button><button class="maximize-btn">â</button><button class="close-btn">x</button></div></div>
            <div class="window-content">
                <div class="paint-toolbar"></div>
                <canvas id="paint-canvas"></canvas>
            </div>
        </div>
    </div>

    <div class="taskbar"><button class="start-button" id="start-button"><img src="https://img.icons8.com/win95/48/windows-logo.png"><span data-lang-key="start">Start</span></button><div class="taskbar-apps"></div><div class="clock" id="clock"></div></div>
    
    <div id="start-menu" class="menu">
        <ul>
            <li class="has-submenu"><img src="https://img.icons8.com/win95/48/programs.png"> <span data-lang-key="programs">Programme</span>
                <ul class="menu submenu">
                    <li data-window="explorer-window"><img src="https://img.icons8.com/win95/48/file-explorer.png"> <span data-lang-key="explorer">Explorer</span></li>
                    <li data-window="browser-window"><img src="https://img.icons8.com/win95/48/internet-explorer.png"> <span data-lang-key="browser">Internet</span></li>
                    <li data-window="paint-window"><img src="https://img.icons8.com/win95/48/paint.png"> <span data-lang-key="paint">Paint</span></li>
                    <li data-window="terminal-window"><img src="https://img.icons8.com/win95/48/console.png"> <span data-lang-key="terminal">Terminal</span></li>
                    <li data-window="snake-window"><img src="https://img.icons8.com/win95/48/snake.png"> <span data-lang-key="snake">Snake</span></li>
                </ul>
            </li>
            <li class="has-submenu"><img src="https://img.icons8.com/win95/48/documents.png"> <span data-lang-key="documents">Dokumente</span>
                <ul class="menu submenu">
                    <li data-action="open-editor" data-file="about.txt"><img src="https://img.icons8.com/win95/48/documents.png"> <span>about.txt</span></li>
                    <li data-action="open-editor" data-file="skills.txt"><img src="https://img.icons8.com/win95/48/documents.png"> <span>skills.txt</span></li>
                    <li data-action="open-editor" data-file="contact.txt"><img src="https://img.icons8.com/win95/48/documents.png"> <span>contact.txt</span></li>
                    <li data-action="open-editor" data-file="Readme.txt"><img src="https://img.icons8.com/win95/48/documents.png"> <span>Readme.txt</span></li>
                </ul>
            </li>
            <li data-window="info-window"><img src="https://img.icons8.com/win95/48/help.png"> <span data-lang-key="help">Hilfe</span></li>
            <li class="menu-divider"></li>
            <li data-window="settings-window"><img src="https://img.icons8.com/win95/48/settings.png"> <span data-lang-key="settings">Einstellungen</span></li>
            <li class="menu-divider"></li>
            <li data-action="logout"><img src="https://img.icons8.com/win95/48/exit.png"> <span data-lang-key="logout">Logout</span></li>
            <li data-action="restart"><img src="https://img.icons8.com/win95/48/reboot.png"> <span data-lang-key="restart_menu">Neustart</span></li>
        </ul>
    </div>

    <div id="context-menu" class="menu">
        <ul>
            <li>Ansicht</li>
            <li>Sortieren nach</li>
            <li class="menu-divider"></li>
            <li>Neu</li>
            <li class="menu-divider"></li>
            <li>Eigenschaften</li>
        </ul>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', async () => {
            // --- FIREBASE SETUP ---
            let db;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                const auth = getAuth(app);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase initialized and user signed in.");
                listenForGuestbookEntries();
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }

            // --- INITIAL SETUP ---
            const windows = document.querySelectorAll('.window');
            const taskbar = document.querySelector('.taskbar');
            const startButton = document.getElementById('start-button');
            const startMenu = document.getElementById('start-menu');
            const desktop = document.getElementById('desktop');
            const taskbarApps = document.querySelector('.taskbar-apps');
            const contextMenu = document.getElementById('context-menu');
            let zIndexCounter = 10;
            
            // --- TRANSLATIONS ---
            const translations = {
                de: {
                    aboutMe: "Ãber Mich", projects: "Projekte", skills: "FÃ¤higkeiten", contact: "Kontakt", terminal: "Terminal", snake: "Snake", info: "Readme.txt", explorer: "Explorer", guestbook: "GÃ¤stebuch", browser: "Internet", paint: "Paint",
                    programs: "Programme", documents: "Dokumente", help: "Hilfe",
                    welcomeTitle: "Willkommen auf meinem Desktop!", myProjects: "Meine Projekte", projectDesc1: "Eine kurze Beschreibung...", myTechStack: "Mein Tech-Stack",
                    techStackIntro: "Hier sind einige Technologien...", contactTitle: "Lassen Sie uns vernetzen!", contactIntro: "Ich bin immer offen...",
                    restart: "Neustart", settings: "Einstellungen", start: "Start", language: "Sprache", theme: "Farbschema",
                    theme_default: "Klassisch", theme_night: "Nachtmodus", theme_purple: "Lila Traum",
                    infoTitle: "Willkommen!", infoHeading: "Hey! SchÃ¶n, dass du da bist!",
                    infoIntro: "Dieses Portfolio ist ein bisschen anders. Stell es dir wie einen alten Computer-Desktop vor, den du erkunden kannst. Hier ein paar Tipps, um loszulegen:",
                    infoFeature1: "Symbole & Fenster: Alle Symbole auf dem Desktop sind klickbar! Ein Doppelklick Ã¶ffnet ein Fenster. Du kannst die Fenster an der Titelleiste packen und verschieben.",
                    infoFeature2: "Das Terminal: FÃ¼r die Nerds: Ãffne das Terminal und nutze Befehle wie 'ls', 'cd' und 'cat', um durch meine Dateien zu stÃ¶bern. Gib 'help' ein fÃ¼r eine BefehlsÃ¼bersicht.",
                    infoFeature3: "Einstellungen: Keine Lust auf die Farbe? Klick auf 'Start' und dann auf 'Einstellungen', um das Farbschema nach deinem Geschmack anzupassen.",
                    infoFeature4: "Spiel & SpaÃ: Langeweile? Spiel eine Runde Snake! Und fÃ¼r die echten Retro-Fans gibt es natÃ¼rlich auch den Konami-Code (ââââââââBA).",
                    infoOutro: "Viel SpaÃ beim Entdecken!",
                    logout: "Logout",
                    restart_menu: "Neustart"
                },
                en: {
                    aboutMe: "About Me", projects: "Projects", skills: "Skills", contact: "Contact", terminal: "Terminal", snake: "Snake", info: "Readme.txt", explorer: "Explorer", guestbook: "Guestbook", browser: "Internet", paint: "Paint",
                    programs: "Programs", documents: "Documents", help: "Help",
                    welcomeTitle: "Welcome to my Desktop!", myProjects: "My Projects", projectDesc1: "A brief description...", myTechStack: "My Tech Stack",
                    techStackIntro: "Here are some technologies...", contactTitle: "Let's Connect!", contactIntro: "I am always open...",
                    restart: "Restart", settings: "Settings", start: "Start", language: "Language", theme: "Color Scheme",
                    theme_default: "Classic", theme_night: "Night Mode", theme_purple: "Purple Dream",
                    infoTitle: "Welcome!", infoHeading: "Hey! Glad you're here!",
                    infoIntro: "This portfolio is a bit different. Imagine it's an old computer desktop you can explore. Here are a few tips to get you started:",
                    infoFeature1: "Icons & Windows: All icons on the desktop are clickable! A double-click opens a window. You can grab and move windows by their title bar.",
                    infoFeature2: "The Terminal: For the nerds: Open the terminal and use commands like 'ls', 'cd', and 'cat' to browse my files. Type 'help' for a command overview.",
                    infoFeature3: "Settings: Don't like the color? Click 'Start' and then 'Settings' to customize the color scheme to your liking.",
                    infoFeature4: "Fun & Games: Bored? Play a round of Snake! And for the true retro fans, there's the Konami code, of course (ââââââââBA).",
                    infoOutro: "Have fun exploring!",
                    logout: "Logout",
                    restart_menu: "Restart"
                }
            };
            
            function setLanguage(lang) {
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.dataset.langKey;
                    if (translations[lang] && translations[lang][key]) {
                        el.innerText = translations[lang][key];
                    }
                });
            }
            document.getElementById('language-select').addEventListener('change', (e) => setLanguage(e.target.value));

            // --- SOUNDS ---
            const synth = new Tone.Synth().toDestination();
            function playSound(note) { if (Tone.context.state !== 'running') { Tone.start(); } synth.triggerAttackRelease(note, "8n"); }
            function playErrorSound() { playSound("C3"); }
            function playClickSound() { playSound("C5"); }
            function playStartupSound() {
                if (Tone.context.state !== 'running') { Tone.start(); }
                const synth = new Tone.PolySynth().toDestination();
                const now = Tone.now();
                synth.triggerAttackRelease(["C4", "E4", "G4"], "8n", now);
                synth.triggerAttackRelease(["G4", "C5", "E5"], "8n", now + 0.2);
            }

            // --- CLOCK ---
            const clockElement = document.getElementById('clock');
            function updateClock() { const now = new Date(); clockElement.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`; }
            setInterval(updateClock, 1000); updateClock();

            // --- SYSTEM & WINDOW FUNCTIONS (DEFINED EARLY) ---
            let idleTimer, lockTimer;
            let screensaverActive = false;
            const screensaverCanvas = document.getElementById('screensaver-canvas');
            const screensaverCtx = screensaverCanvas.getContext('2d');
            let stars = [];
            let screensaverAnimation;

            function bringToFront(windowElement) { 
                zIndexCounter++; 
                windowElement.style.zIndex = zIndexCounter;
                document.querySelectorAll('.taskbar-app-btn').forEach(btn => btn.classList.remove('active'));
                const taskbarBtn = document.querySelector(`.taskbar-app-btn[data-window-id="${windowElement.id}"]`);
                if(taskbarBtn) taskbarBtn.classList.add('active');
            }

            function openWindow(windowId) {
                const windowElement = document.getElementById(windowId);
                if (windowElement) {
                    playClickSound();
                    windowElement.style.display = 'flex';
                    bringToFront(windowElement);
                    if (windowId === 'terminal-window') document.getElementById('terminal-input').focus();
                    if (windowId === 'snake-window' && !isGameRunning) startGame();
                    if (windowId === 'paint-window') initializePaint();

                    // Create taskbar button if it doesn't exist
                    if (!document.querySelector(`.taskbar-app-btn[data-window-id="${windowId}"]`)) {
                        const btn = document.createElement('button');
                        btn.className = 'taskbar-app-btn';
                        btn.dataset.windowId = windowId;
                        btn.textContent = windowElement.querySelector('.title-bar span').textContent;
                        btn.addEventListener('click', () => {
                            playClickSound();
                            if (windowElement.style.display === 'none') {
                                openWindow(windowId);
                            } else {
                                bringToFront(windowElement);
                            }
                        });
                        taskbarApps.appendChild(btn);
                    }
                }
            }
            
            function clearIdleTimers() {
                clearTimeout(idleTimer);
                clearTimeout(lockTimer);
            }

            function stopScreensaver() {
                document.getElementById('screensaver').style.display = 'none';
                screensaverActive = false;
                cancelAnimationFrame(screensaverAnimation);
                resetIdleTimers();
            }

            function resetIdleTimers() {
                clearIdleTimers();
                if(screensaverActive) stopScreensaver();

                idleTimer = setTimeout(startScreensaver, 3 * 60 * 1000); // 3 minutes
                lockTimer = setTimeout(logout, 5 * 60 * 1000); // 5 minutes
            }

            function logout() {
                windows.forEach(win => win.style.display = 'none');
                desktop.style.display = 'none';
                taskbar.style.display = 'none';
                const loginScreen = document.getElementById('login-screen');
                loginScreen.style.display = 'flex';
                document.getElementById('username-input').focus();
                clearIdleTimers();
            }

            function triggerBSOD() {
                const bsod = document.getElementById('bsod');
                bsod.innerHTML = `
 A fatal exception 0E has occurred at 0028:C0011E36 in VXD VMM(01) + 
 00010E36. The current application will be terminated.

 * Press any key to terminate the current application.
 * Press CTRL+ALT+DEL again to restart your computer. You will
    lose any unsaved information in all applications.

          Press any key to continue _
                `;
                bsod.style.display = 'block';
                document.body.classList.add('flicker');

                setTimeout(() => {
                    document.body.classList.remove('flicker');
                    bsod.style.display = 'none';
                    desktop.style.display = 'none';
                    taskbar.style.display = 'none';
                    
                    const bootScreen = document.getElementById('boot-screen');
                    bootScreen.style.display = 'block';
                    bootScreen.innerHTML = '';

                    const bootMessages = [
                        'Retro BIOS v1.2',
                        'Checking RAM: 64MB OK',
                        'Initializing IDE devices...',
                        'Detecting Primary Master: HDD-MAX-123',
                        'Detecting Secondary Slave: CD-ROM',
                        'Loading Kernel...',
                        'Starting Portfolio OS...',
                        ''
                    ];

                    let i = 0;
                    const bootInterval = setInterval(() => {
                        if (i < bootMessages.length) {
                            bootScreen.innerHTML += bootMessages[i] + '\n';
                            i++;
                        } else {
                            clearInterval(bootInterval);
                            bootScreen.style.display = 'none';
                            logout();
                        }
                    }, 500);

                }, 2500);
            }

            // --- EVENT LISTENERS ---
            windows.forEach(win => win.addEventListener('mousedown', () => bringToFront(win)));
            
            document.querySelectorAll('.icon').forEach(icon => {
                icon.addEventListener('dblclick', () => {
                    const windowId = icon.dataset.window;
                    const action = icon.dataset.action;
                    const path = icon.dataset.path;

                    if (windowId) {
                        openWindow(windowId);
                    } else if (action === 'open-explorer') {
                        openExplorer(path.split('/'));
                    }
                });
            });

            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    playClickSound();
                    const windowElement = e.target.closest('.window');
                    windowElement.style.display = 'none';
                    const taskbarBtn = document.querySelector(`.taskbar-app-btn[data-window-id="${windowElement.id}"]`);
                    if(taskbarBtn) taskbarBtn.remove();
                    if(windowElement.id === 'snake-window') stopGame();
                });
            });

            document.querySelectorAll('.minimize-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    playClickSound();
                    const windowElement = e.target.closest('.window');
                    windowElement.style.display = 'none';
                    const taskbarBtn = document.querySelector(`.taskbar-app-btn[data-window-id="${windowElement.id}"]`);
                    if(taskbarBtn) taskbarBtn.classList.remove('active');
                });
            });

            document.querySelectorAll('.maximize-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    playClickSound();
                    const windowElement = e.target.closest('.window');
                    if (windowElement.dataset.isMaximized === 'true') {
                        windowElement.style.top = windowElement.dataset.oldTop;
                        windowElement.style.left = windowElement.dataset.oldLeft;
                        windowElement.style.width = windowElement.dataset.oldWidth;
                        windowElement.style.height = windowElement.dataset.oldHeight;
                        windowElement.dataset.isMaximized = 'false';
                    } else {
                        windowElement.dataset.oldTop = windowElement.style.top;
                        windowElement.dataset.oldLeft = windowElement.style.left;
                        windowElement.dataset.oldWidth = windowElement.style.width;
                        windowElement.dataset.oldHeight = windowElement.style.height;
                        windowElement.style.top = '0';
                        windowElement.style.left = '0';
                        windowElement.style.width = '100%';
                        windowElement.style.height = `calc(100vh - 40px)`;
                        windowElement.dataset.isMaximized = 'true';
                    }
                });
            });

            startButton.addEventListener('click', (e) => { e.stopPropagation(); playClickSound(); startMenu.style.display = startMenu.style.display === 'block' ? 'none' : 'block'; });
            document.body.addEventListener('click', () => { startMenu.style.display = 'none'; contextMenu.style.display = 'none'; });
            startMenu.querySelectorAll('li').forEach(item => {
                item.addEventListener('click', () => {
                    const windowId = item.dataset.window;
                    const action = item.dataset.action;
                    const path = item.dataset.path;
                    const file = item.dataset.file;

                    if (windowId) {
                        openWindow(windowId);
                    } else if (action === 'open-explorer') {
                        openExplorer(path.split('/'));
                    } else if (action === 'open-editor') {
                        const content = getNode(['home', 'user', 'Documents', file]);
                        openEditor(file, content);
                    } else if (action === 'logout') {
                        logout();
                    } else if (action === 'restart') {
                        triggerBSOD();
                    }
                    startMenu.style.display = 'none';
                });
            });

            windows.forEach(windowElement => {
                const titleBar = windowElement.querySelector('.title-bar');
                let isDragging = false, offsetX, offsetY;
                titleBar.addEventListener('mousedown', (e) => {
                    if (e.target.closest('.window-controls')) return;
                    isDragging = true;
                    offsetX = e.clientX - windowElement.offsetLeft;
                    offsetY = e.clientY - windowElement.offsetTop;
                    bringToFront(windowElement);
                });
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        let newX = e.clientX - offsetX, newY = e.clientY - offsetY;
                        const maxX = window.innerWidth - windowElement.offsetWidth, maxY = window.innerHeight - windowElement.offsetHeight - taskbar.offsetHeight;
                        windowElement.style.left = `${Math.max(0, Math.min(newX, maxX))}px`;
                        windowElement.style.top = `${Math.max(0, Math.min(newY, maxY))}px`;
                    }
                });
                document.addEventListener('mouseup', () => isDragging = false);
            });
            
            document.getElementById('theme-selector').addEventListener('change', (e) => {
                document.body.classList.remove('theme-night', 'theme-purple');
                if (e.target.value !== 'default') document.body.classList.add(e.target.value);
                const bgColor = window.getComputedStyle(document.body).backgroundColor;
                document.querySelectorAll('.icon span').forEach(span => span.style.backgroundColor = bgColor);
            });
            
            const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
            let konamiIndex = 0;
            document.addEventListener('keydown', (e) => {
                if (e.key === konamiCode[konamiIndex]) {
                    if (++konamiIndex === konamiCode.length) { openWindow('terminal-window'); konamiIndex = 0; }
                } else { konamiIndex = 0; }
            });

            // --- FILE SYSTEM & EXPLORER ---
            const fileSystem = {
                'bin': { 'bash': 'Executable', 'ls': 'Executable' },
                'etc': { 'motd': 'Willkommen auf meinem Portfolio-Desktop!', 'hosts': '127.0.0.1 localhost' },
                'home': {
                    'user': {
                        'Desktop': {},
                        'Documents': {
                            'about.txt': "Max Mustermann - Ein kreativer Entwickler...",
                            'projects': {
                                'Retro-Portfolio': { 'doku.txt': 'Projekt: Dieses Portfolio!\nTechnologien: HTML, CSS, JS\nBeschreibung: Eine interaktive Webseite im Stil eines alten Betriebssystems.' },
                                'Snake-Klon': { 'doku.txt': 'Projekt: Snake\nTechnologien: HTML Canvas, JS\nBeschreibung: Ein einfacher Klon des klassischen Spiels.' }
                            },
                            'skills.txt': "JavaScript, Python, React, Node.js, ...",
                            'contact.txt': "Email: max.mustermann@example.com\nLinkedIn: linkedin.com/in/maxmustermann",
                            'Readme.txt': "Dies ist die Readme-Datei. Sie enthÃ¤lt wichtige Informationen."
                        }
                    }
                }
            };
            let explorerPath = ['home', 'user'];

            const explorerWindow = document.getElementById('explorer-window');
            const explorerMain = explorerWindow.querySelector('.explorer-main');
            const explorerSidebar = explorerWindow.querySelector('.explorer-sidebar');
            const explorerAddressBar = explorerWindow.querySelector('#explorer-address-bar');

            function renderExplorer() {
                explorerMain.innerHTML = '';
                explorerAddressBar.textContent = `C:\\${explorerPath.join('\\')}`;
                const node = getNode(explorerPath);

                if (explorerPath.length > 1) { // Back button
                    const backItem = document.createElement('div');
                    backItem.className = 'fs-item';
                    backItem.innerHTML = `<img src="https://img.icons8.com/win95/48/up.png"><span>..</span>`;
                    backItem.addEventListener('dblclick', () => {
                        explorerPath.pop();
                        renderExplorer();
                    });
                    explorerMain.appendChild(backItem);
                }

                for (const name in node) {
                    const item = node[name];
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'fs-item';
                    const isDir = typeof item === 'object';
                    itemDiv.innerHTML = `<img src="${isDir ? 'https://img.icons8.com/win95/48/folder.png' : 'https://img.icons8.com/win95/48/documents.png'}"><span>${name}</span>`;
                    
                    if (isDir) {
                        itemDiv.addEventListener('dblclick', () => {
                            explorerPath.push(name);
                            renderExplorer();
                        });
                    } else {
                        itemDiv.addEventListener('dblclick', () => {
                            openEditor(name, item);
                        });
                    }
                    explorerMain.appendChild(itemDiv);
                }
            }

            function openExplorer(path) {
                explorerPath = [...path];
                renderExplorer();
                renderExplorerSidebar();
                openWindow('explorer-window');
            }

            function renderExplorerSidebar() {
                explorerSidebar.innerHTML = '';
                const quickAccess = { 'Desktop': ['home', 'user', 'Desktop'], 'Documents': ['home', 'user', 'Documents'] };
                for (const name in quickAccess) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'explorer-sidebar-item';
                    itemDiv.innerHTML = `<img src="https://img.icons8.com/win95/48/folder.png"><span>${name}</span>`;
                    itemDiv.addEventListener('click', () => {
                        explorerPath = quickAccess[name];
                        renderExplorer();
                    });
                    explorerSidebar.appendChild(itemDiv);
                }
            }

            function openEditor(fileName, content) {
                document.getElementById('editor-title').textContent = fileName;
                document.getElementById('editor-content').textContent = content;
                openWindow('editor-window');
            }
            
            // --- TERMINAL ---
            const terminalInput = document.getElementById('terminal-input');
            const terminalOutput = document.getElementById('terminal-output');
            const terminalPrompt = document.getElementById('terminal-prompt');
            let currentPath = ['home', 'user'];
            let awaitingFormatConfirmation = false;
            
            const getNode = (pathArray) => {
                let currentNode = fileSystem;
                for (const part of pathArray) {
                    if (currentNode && typeof currentNode === 'object' && currentNode[part] !== undefined) {
                        currentNode = currentNode[part];
                    } else { return null; }
                }
                return currentNode;
            };

            const resolvePath = (rawPath) => {
                let pathParts = rawPath.startsWith('/') ? [] : [...currentPath];
                if (rawPath === '~' || !rawPath) return ['home', 'user'];
                if (rawPath.startsWith('~/')) {
                    pathParts = ['home', 'user'];
                    rawPath = rawPath.substring(2);
                }
                
                const segments = rawPath.split('/').filter(p => p);
                for (const segment of segments) {
                    if (segment === '..') {
                        if (pathParts.length > 0) pathParts.pop();
                    } else if (segment !== '.') {
                        pathParts.push(segment);
                    }
                }
                return pathParts;
            };
            
            const updatePrompt = () => {
                const pathStr = currentPath.join('/');
                const homePath = 'home/user';
                if (pathStr === homePath) {
                    terminalPrompt.textContent = `~/ $ `;
                } else if (pathStr.startsWith(homePath)) {
                    terminalPrompt.textContent = `~/${pathStr.substring(homePath.length + 1)} $ `;
                } else {
                    terminalPrompt.textContent = `/${pathStr} $ `;
                }
            };
            
            const printToTerminal = (text, isHTML = false) => {
                terminalOutput.innerHTML += (isHTML ? text : text.replace(/</g, "&lt;").replace(/>/g, "&gt;")) + '\n';
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            };

            printToTerminal("Retro Terminal v3.0\nType 'help' for commands.");
            updatePrompt();

            terminalInput.addEventListener('keydown', (e) => {
                if (e.key !== 'Enter' || !terminalInput.value) return;
                
                const fullCommand = terminalInput.value.trim().toLowerCase();
                printToTerminal(`${terminalPrompt.textContent}${fullCommand}`);
                terminalInput.value = '';

                if (awaitingFormatConfirmation) {
                    if (fullCommand === 'j' || fullCommand === 'y') {
                        printToTerminal("Formatiere Laufwerk C:...");
                        let progress = 0;
                        const interval = setInterval(() => {
                            progress += 10;
                            printToTerminal(`${progress} Prozent abgeschlossen.`);
                            if (progress >= 100) {
                                clearInterval(interval);
                                printToTerminal("Fehler beim Formatieren. Das System ist instabil.");
                                setTimeout(triggerBSOD, 1000);
                            }
                        }, 200);
                    } else {
                        printToTerminal("Formatierung abgebrochen.");
                    }
                    awaitingFormatConfirmation = false;
                    return;
                }

                const [command, ...args] = fullCommand.split(/\s+/);

                switch(command) {
                    case 'help': 
                        printToTerminal("Commands: help, ls, cd, cat, pwd, whoami, clear, format c:");
                        break;
                    case 'format':
                        if (args[0] && args[0] === 'c:') {
                            printToTerminal("WARNUNG: Alle Daten auf Laufwerk C: werden gelÃ¶scht!\nFortfahren? (J/N)");
                            awaitingFormatConfirmation = true;
                        } else {
                            printToTerminal("format: UngÃ¼ltiger Parameter. Beispiel: format c:");
                        }
                        break;
                    case 'whoami': printToTerminal("user"); break;
                    case 'clear': terminalOutput.innerHTML = ''; break;
                    case 'pwd': printToTerminal('/' + currentPath.join('/')); break;
                    case 'ls': {
                        const path = args[0] ? resolvePath(args[0]) : currentPath;
                        const node = getNode(path);
                        if (node && typeof node === 'object') {
                            let output = '';
                            Object.keys(node).forEach(key => {
                                output += (typeof node[key] === 'object' ? `<span class="dir">${key}</span>` : key) + '  ';
                            });
                            printToTerminal(output, true);
                        } else { printToTerminal(`ls: cannot access '${args[0] || '.'}': No such file or directory`); }
                        break;
                    }
                    case 'cd': {
                        const targetPath = resolvePath(args[0]);
                        const node = getNode(targetPath);
                        if (node && typeof node === 'object') {
                            currentPath = targetPath;
                        } else { printToTerminal(`cd: no such directory: ${args[0] || '~'}`); }
                        updatePrompt();
                        break;
                    }
                    case 'cat': {
                        const targetPath = resolvePath(args[0] || '');
                        const parentPath = targetPath.slice(0, -1);
                        const fileName = targetPath[targetPath.length - 1];
                        const parentNode = getNode(parentPath);
                        if (parentNode && typeof parentNode[fileName] === 'string') {
                            printToTerminal(parentNode[fileName]);
                        } else if (parentNode && typeof parentNode[fileName] === 'object') {
                            printToTerminal(`cat: ${args[0]}: Is a directory`);
                        } else { printToTerminal(`cat: ${args[0]}: No such file or directory`); }
                        break;
                    }
                    default: if(command) printToTerminal(`Command not found: ${command}`);
                }
            });
            
            // --- SNAKE GAME ---
            const canvas = document.getElementById('snake-canvas'), ctx = canvas.getContext('2d');
            const snakeRestartBtn = document.getElementById('snake-restart-btn');
            const tileSize = 20;
            let snake, food, score, direction, gameLoop, isGameRunning = false;
            
            function initGame() { snake = [{ x: 10, y: 10 }]; food = {}; score = 0; direction = 'right'; placeFood(); }
            function placeFood() { food.x = Math.floor(Math.random() * (canvas.width / tileSize)); food.y = Math.floor(Math.random() * (canvas.height / tileSize)); }
            function draw() { ctx.fillStyle = '#111'; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = '#00FF00'; snake.forEach(s => ctx.fillRect(s.x * tileSize, s.y * tileSize, tileSize - 1, tileSize - 1)); ctx.fillStyle = '#FF0000'; ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize - 1, tileSize - 1); ctx.fillStyle = 'white'; ctx.font = '20px "VT323"'; ctx.fillText(`Score: ${score}`, 10, 20); }
            function update() { const head = { x: snake[0].x, y: snake[0].y }; switch (direction) { case 'up': head.y--; break; case 'down': head.y++; break; case 'left': head.x--; break; case 'right': head.x++; break; } if (head.x < 0 || head.x * tileSize >= canvas.width || head.y < 0 || head.y * tileSize >= canvas.height || snake.some((s,i) => i > 0 && s.x === head.x && s.y === head.y)) { gameOver(); return; } snake.unshift(head); if (head.x === food.x && head.y === food.y) { score++; placeFood(); } else { snake.pop(); } draw(); }
            function gameOver() { stopGame(); ctx.fillStyle = 'rgba(0, 0, 0, 0.7)'; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = 'white'; ctx.font = '40px "VT323"'; ctx.textAlign = 'center'; ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20); ctx.font = '20px "VT323"'; ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20); ctx.textAlign = 'left'; snakeRestartBtn.style.display = 'block'; }
            function startGame() { if(isGameRunning) stopGame(); snakeRestartBtn.style.display = 'none'; initGame(); gameLoop = setInterval(update, 100); isGameRunning = true; document.addEventListener('keydown', changeDirection); }
            function stopGame() { clearInterval(gameLoop); isGameRunning = false; document.removeEventListener('keydown', changeDirection); }
            function changeDirection(e) { const key = e.key; if (key === 'ArrowUp' && direction !== 'down') direction = 'up'; else if (key === 'ArrowDown' && direction !== 'up') direction = 'down'; else if (key === 'ArrowLeft' && direction !== 'right') direction = 'left'; else if (key === 'ArrowRight' && direction !== 'left') direction = 'right'; }
            snakeRestartBtn.addEventListener('click', startGame);
        
            // --- INACTIVITY AND SCREENSAVER ---
            const loginBtn = document.getElementById('login-btn');
            const usernameInput = document.getElementById('username-input');

            function performLogin() {
                if (usernameInput.value.trim() !== '') {
                    playStartupSound();
                    const loginScreen = document.getElementById('login-screen');
                    loginScreen.style.display = 'none';
                    desktop.style.display = 'block';
                    taskbar.style.display = 'flex';
                    openWindow('info-window');
                    resetIdleTimers();
                }
            }
            loginBtn.addEventListener('click', performLogin);
            usernameInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    performLogin();
                }
            });

            function setupScreensaver() {
                screensaverCanvas.width = window.innerWidth;
                screensaverCanvas.height = window.innerHeight;
                stars = [];
                for(let i = 0; i < 200; i++) {
                    stars.push({
                        x: Math.random() * screensaverCanvas.width - screensaverCanvas.width / 2,
                        y: Math.random() * screensaverCanvas.height - screensaverCanvas.height / 2,
                        z: Math.random() * screensaverCanvas.width
                    });
                }
            }

            function drawScreensaver() {
                screensaverCtx.fillStyle = 'black';
                screensaverCtx.fillRect(0, 0, screensaverCanvas.width, screensaverCanvas.height);
                screensaverCtx.fillStyle = 'white';
                
                for(let i = 0; i < stars.length; i++) {
                    let star = stars[i];
                    star.z -= 2;
                    if(star.z <= 0) {
                        star.z = screensaverCanvas.width;
                    }
                    
                    let k = 128 / star.z;
                    let px = star.x * k + screensaverCanvas.width / 2;
                    let py = star.y * k + screensaverCanvas.height / 2;
                    
                    if(px >= 0 && px < screensaverCanvas.width && py >= 0 && py < screensaverCanvas.height) {
                        let size = (1 - star.z / screensaverCanvas.width) * 5;
                        screensaverCtx.fillRect(px, py, size, size);
                    }
                }
                screensaverAnimation = requestAnimationFrame(drawScreensaver);
            }

            function startScreensaver() {
                setupScreensaver();
                document.getElementById('screensaver').style.display = 'block';
                screensaverActive = true;
                drawScreensaver();
            }
            
            // --- GUESTBOOK ---
            const guestbookForm = document.getElementById('guestbook-form');
            const guestbookName = document.getElementById('guestbook-name');
            const guestbookMessage = document.getElementById('guestbook-message');
            const guestbookEntries = document.getElementById('guestbook-entries');

            function listenForGuestbookEntries() {
                if (!db) return;
                const q = query(collection(db, `artifacts/${appId}/public/data/guestbook`), orderBy('timestamp', 'desc'));
                onSnapshot(q, (snapshot) => {
                    guestbookEntries.innerHTML = '';
                    snapshot.forEach((doc) => {
                        const entry = doc.data();
                        const entryDiv = document.createElement('div');
                        entryDiv.className = 'guestbook-entry';
                        const date = entry.timestamp?.toDate().toLocaleString('de-DE') || '...';
                        entryDiv.innerHTML = `<strong>${entry.name || 'Anonym'}</strong> <small>(${date})</small><p>${entry.message || ''}</p>`;
                        guestbookEntries.appendChild(entryDiv);
                    });
                });
            }

            guestbookForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!db || !guestbookName.value || !guestbookMessage.value) return;
                
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/guestbook`), {
                        name: guestbookName.value,
                        message: guestbookMessage.value,
                        timestamp: serverTimestamp()
                    });
                    guestbookName.value = '';
                    guestbookMessage.value = '';
                } catch (error) {
                    console.error("Error adding document: ", error);
                }
            });

            // --- PAINT ---
            let paintCanvas, paintCtx, painting, paintColor;
            function initializePaint() {
                paintCanvas = document.getElementById('paint-canvas');
                const paintToolbar = document.querySelector('.paint-toolbar');
                paintCtx = paintCanvas.getContext('2d');
                
                const parentContent = paintCanvas.parentElement;
                paintCanvas.width = parentContent.clientWidth - 40;
                paintCanvas.height = parentContent.clientHeight - 10;

                painting = false;
                paintColor = '#000000';

                const colors = ['#000000', '#FFFFFF', '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];
                paintToolbar.innerHTML = '';
                colors.forEach(color => {
                    const swatch = document.createElement('div');
                    swatch.className = 'color-swatch';
                    swatch.style.backgroundColor = color;
                    if (color === paintColor) swatch.classList.add('active');
                    swatch.addEventListener('click', () => {
                        paintColor = color;
                        paintToolbar.querySelector('.active').classList.remove('active');
                        swatch.classList.add('active');
                    });
                    paintToolbar.appendChild(swatch);
                });

                function startPosition(e) { painting = true; draw(e); }
                function endPosition() { painting = false; paintCtx.beginPath(); }
                function draw(e) {
                    if (!painting) return;
                    paintCtx.lineWidth = 5;
                    paintCtx.lineCap = 'round';
                    paintCtx.strokeStyle = paintColor;

                    paintCtx.lineTo(e.clientX - paintCanvas.getBoundingClientRect().left, e.clientY - paintCanvas.getBoundingClientRect().top);
                    paintCtx.stroke();
                    paintCtx.beginPath();
                    paintCtx.moveTo(e.clientX - paintCanvas.getBoundingClientRect().left, e.clientY - paintCanvas.getBoundingClientRect().top);
                }

                paintCanvas.addEventListener('mousedown', startPosition);
                paintCanvas.addEventListener('mouseup', endPosition);
                paintCanvas.addEventListener('mousemove', draw);
            }


            // Initial timer setup
            resetIdleTimers();

            // Reset timers on user activity
            window.addEventListener('mousemove', resetIdleTimers);
            window.addEventListener('keydown', resetIdleTimers);
        });
    </script>
</body>
</html>
